<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å‰åœ‹ä¸­ 204 é›»å­è¯çµ¡ç°¿</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        :root { --muji-bg: #f2f0eb; --blackboard-green: #2c4c3e; --chalk-white: #fdfdfd; --muji-charcoal: #333333; }
        * { box-sizing: border-box; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--muji-bg); color: var(--muji-charcoal); margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* æ¨™é¡Œ */
        .header-section { text-align: center; margin-bottom: 25px; }
        .school-info, .main-title { font-size: 2em; font-weight: 700; color: var(--muji-charcoal); display: block; line-height: 1.4; }
        
        /* é»‘æ¿å„ªåŒ– */
        .blackboard {
            background-color: var(--blackboard-green);
            background-image: radial-gradient(circle at 50% 50%, #3a5f4e 0%, #2c4c3e 100%);
            border: 12px solid #5d4037;
            border-radius: 4px;
            padding: 20px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5), 0 5px 15px rgba(0,0,0,0.3);
            margin-bottom: 15px;
            text-align: center;
        }
        .bb-title { color: #ffd54f; font-size: 1.8em; font-weight: 700; margin-bottom: 5px; }
        .bb-date { color: rgba(255,255,255,0.8); font-size: 1.1em; margin-bottom: 15px; border-bottom: 1px dashed rgba(255,255,255,0.3); padding-bottom: 10px; }
        .homework-content { color: var(--chalk-white); font-size: 1.4em; line-height: 1.8; white-space: pre-wrap; min-height: 100px; text-align: left; }
        
        .section-title { font-size: 1.3em; font-weight: 700; border-left: 6px solid var(--muji-charcoal); padding-left: 12px; margin: 25px 0 15px 0; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 700; }
        select, textarea { width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 6px; font-size: 18px; font-family: inherit; }
        
        .sig-wrapper { border: 2px solid var(--muji-charcoal); background: #fff; border-radius: 6px; }
        canvas { width: 100%; height: 350px; touch-action: none; display: block; }
        
        .btn { background-color: var(--muji-charcoal); color: white; border: none; padding: 18px; cursor: pointer; width: 100%; font-size: 20px; border-radius: 6px; font-weight: 700; }
        .btn-history { background: none; border: 2px solid #888; color: #888; font-size: 16px; margin-top: 5px; height: 50px; }

        /* æ­·å²å±•é–‹å€ */
        #history-box { display: none; padding: 15px; background: #f0f0f0; margin-top: 10px; border-radius: 4px; border: 1px solid #ddd; }
        .hist-item { border-bottom: 1px solid #ccc; padding: 10px 0; }

        /* è€å¸«ç«¯ç®¡ç† */
        .admin-area { display: none; margin-top: 40px; padding: 20px; background: #eef2f3; border-radius: 8px; border: 2px solid #ccc; }
        .edit-card { background: white; border: 1px solid #bbb; padding: 10px; margin-bottom: 10px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <span class="school-info">å¤§å‰åœ‹ä¸­ äºŒå¹´å››ç­</span>
        <span class="main-title">é›»å­è¯çµ¡ç°¿</span>
    </div>

    <div class="blackboard">
        <div class="bb-title">ä»Šæ—¥åŠŸèª²</div>
        <div class="bb-date" id="hw-date">æ—¥æœŸè®€å–ä¸­...</div>
        <div id="hw-content" class="homework-content">è®€å–ä¸­...</div>
    </div>
    <button class="btn btn-history" onclick="toggleHistory()">ğŸ“‚ æŸ¥çœ‹ä¹‹å‰åŠŸèª² (å±•é–‹/æ”¶èµ·)</button>
    <div id="history-box"></div>

    <div class="section-title">å®¶é•·ç°½å</div>
    <div class="input-group">
        <label>1. é¸æ“‡å­¸ç”Ÿ</label>
        <select id="student-sel"><option value="">è«‹é»æ“Šé¸æ“‡åº§è™Ÿå§“å</option></select>
    </div>
    <div class="input-group">
        <label>2. æƒ³å°è€å¸«èªªçš„è©±</label>
        <textarea id="comment" rows="2"></textarea>
    </div>
    <div class="input-group">
        <label>3. å®¶é•·ç°½å</label>
        <div class="sig-wrapper"><canvas id="canvas"></canvas></div>
        <button onclick="pad.clear()" style="width:100%; padding:10px; background:none; border:none; text-decoration:underline; color:#666; cursor:pointer;">æ¸…é™¤é‡ç°½</button>
    </div>
    <button class="btn" onclick="saveData()">ç¢ºèªå„²å­˜ä¸¦é€å‡º</button>

    <button onclick="loginAdmin()" style="margin-top:80px; opacity:0.1; background:none; border:none; width:100%;">ç®¡ç†</button>

    <div id="admin-panel" class="admin-area">
        <h3>è€å¸«ç®¡ç†å¾Œå°</h3>
        <div class="input-group">
            <label>ç™¼å¸ƒæ–°åŠŸèª²</label>
            <textarea id="hw-input" rows="3"></textarea>
            <button class="btn" style="background:#444;" onclick="updateHW()">ç™¼å¸ƒä¸¦å°å­˜èˆŠåŠŸèª²</button>
        </div>
        
        <div class="section-title">ç®¡ç†æ­·å²åŠŸèª²ç´€éŒ„</div>
        <div id="admin-history-list"></div>
        
        <div class="section-title">ä»Šæ—¥ç°½åçµ±è¨ˆ</div>
        <div id="stats-area"></div>
        <div id="records-list"></div>
    </div>
</div>

<script>
    const students = [{id:1, name:"ä½•ç¿ä¿¡"}, {id:2, name:"é™³æŸç¿°"}, {id:3, name:"é»ƒæ˜ç’¿"}, {id:4, name:"é»ƒå‰‡å–„"}, {id:5, name:"é»ƒæšç¿°"}, {id:6, name:"åŠ‰æ ¢ç¿"}, {id:7, name:"æ—èŠŠæƒ "}, {id:8, name:"æ®µå­Ÿæ¶µ"}, {id:9, name:"æ´ªç…œæ™´"}, {id:10, name:"å¼µè‚²æ…ˆ"}, {id:11, name:"è¨±ä»¤éœ"}, {id:12, name:"å»–ä»¥æ™¨"}, {id:13, name:"åŠ‰æ™å¦¤"}];
    const sel = document.getElementById('student-sel');
    students.forEach(s => sel.innerHTML += `<option value="${s.id}">${s.id}. ${s.name}</option>`);

    const canvas = document.getElementById('canvas');
    const pad = new SignaturePad(canvas);

    function getFormattedDate() {
        const now = new Date();
        const days = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
        return `${now.toLocaleDateString('zh-TW')} ${days[now.getDay()]}`;
    }

    let currentHW = "å°šæœªè¼¸å…¥åŠŸèª²";
    let historyHW = []; // æ ¼å¼: {id, date, content}
    let records = [];

    document.getElementById('hw-date').innerText = getFormattedDate();
    document.getElementById('hw-content').innerText = currentHW;

    function resizeCanvas() {
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        canvas.width = canvas.offsetWidth * ratio;
        canvas.height = canvas.offsetHeight * ratio;
        canvas.getContext("2d").scale(ratio, ratio);
        pad.clear();
    }
    window.onresize = resizeCanvas;
    resizeCanvas();

    // æŸ¥çœ‹ä¹‹å‰åŠŸèª² (æ”¶åˆåŠŸèƒ½)
    function toggleHistory() {
        const box = document.getElementById('history-box');
        if (box.style.display === 'block') {
            box.style.display = 'none';
        } else {
            if(historyHW.length === 0) {
                box.innerHTML = "ç›®å‰å°šç„¡æ­·å²ç´€éŒ„";
            } else {
                box.innerHTML = historyHW.map(h => `<div class="hist-item"><b>${h.date}</b><br>${h.content}</div>`).join('');
            }
            box.style.display = 'block';
        }
    }

    // è€å¸«ç™¼å¸ƒæ–°åŠŸèª²
    function updateHW() {
        const val = document.getElementById('hw-input').value;
        if(!val) return alert("è«‹è¼¸å…¥å…§å®¹");
        // å°‡èˆŠçš„å­˜å…¥æ­·å²
        historyHW.unshift({ id: Date.now(), date: getFormattedDate(), content: currentHW });
        currentHW = val;
        document.getElementById('hw-content').innerText = currentHW;
        document.getElementById('hw-input').value = '';
        renderAdmin(); // é‡æ–°æ•´ç†å¾Œå°åˆ—è¡¨
        alert("åŠŸèª²å·²æ›´æ–°ï¼");
    }

    // è€å¸«ç·¨è¼¯æ­·å²åŠŸèª²
    function editHistory(id) {
        const item = historyHW.find(h => h.id === id);
        const newText = prompt("è«‹ä¿®æ”¹åŠŸèª²å…§å®¹ï¼š", item.content);
        if(newText !== null) {
            item.content = newText;
            renderAdmin();
        }
    }

    // è€å¸«åˆªé™¤æ­·å²åŠŸèª²
    function deleteHistory(id) {
        if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†æ­·å²ç´€éŒ„å—ï¼Ÿ")) {
            historyHW = historyHW.filter(h => h.id !== id);
            renderAdmin();
        }
    }

    function saveData() {
        const sid = sel.value;
        if(!sid || pad.isEmpty()) return alert("è«‹é¸å–åº§è™Ÿä¸¦ç°½å");
        records.push({ id: Date.now(), name: students.find(s => s.id == sid).name, sid: sid, comment: document.getElementById('comment').value, sig: pad.toDataURL(), time: new Date().toLocaleTimeString() });
        alert("ç°½åå„²å­˜æˆåŠŸï¼");
        pad.clear();
    }

    function loginAdmin() {
        if(prompt("è«‹è¼¸å…¥å¯†ç¢¼ï¼š") === "0904") {
            document.getElementById('admin-panel').style.display = 'block';
            renderAdmin();
        }
    }

    function renderAdmin() {
        // æ¸²æŸ“çµ±è¨ˆ
        const signedIds = records.map(r => parseInt(r.sid));
        const unsigned = students.filter(s => !signedIds.includes(s.id));
        document.getElementById('stats-area').innerHTML = `<div style="background:#fff1f1; padding:10px; border-radius:4px;">æœªç°½åï¼š${unsigned.length > 0 ? unsigned.map(s => s.name).join('ã€') : 'ç„¡'}</div>`;

        // æ¸²æŸ“æ­·å²ç®¡ç†
        const hList = document.getElementById('admin-history-list');
        hList.innerHTML = historyHW.length === 0 ? "ç„¡æ­·å²ç´€éŒ„" : historyHW.map(h => `
            <div class="edit-card">
                <small>${h.date}</small><br>
                <div style="margin:5px 0;">${h.content}</div>
                <button onclick="editHistory(${h.id})">ç·¨è¼¯</button>
                <button onclick="deleteHistory(${h.id})" style="color:red;">åˆªé™¤</button>
            </div>
        `).join('');

        // æ¸²æŸ“å®¶é•·ç°½å
        const rList = document.getElementById('records-list');
        rList.innerHTML = records.map(r => `
            <div style="background:white; margin-top:10px; padding:10px; border-radius:4px; border:1px solid #ddd;">
                <b>${r.sid}. ${r.name} (${r.time})</b><br>ç•™è¨€ï¼š${r.comment || 'ç„¡'}<br>
                <img src="${r.sig}" style="width:100%; border:1px solid #eee;">
                <button onclick="records=records.filter(x=>x.id!=${r.id});renderAdmin();" style="color:red; background:none; border:none; cursor:pointer; font-size:12px;">åˆªé™¤ç°½å</button>
            </div>
        `).join('');
    }
</script>
</body>
</html>
