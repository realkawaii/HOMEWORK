<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å‰åœ‹ä¸­ 204 ç·šä¸Šè¯çµ¡ç°¿</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- 204 ç­å°ˆç”¨ Firebase è¨­å®š (ä¿ç•™åŸè¨­å®š) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDDLO02aKJgvUa6Jk2GGslcWBhOtPHS4hE",
            authDomain: "homework-5072f.firebaseapp.com",
            projectId: "homework-5072f",
            storageBucket: "homework-5072f.firebasestorage.app",
            messagingSenderId: "927888465824",
            appId: "1:927888465824:web:7c6abc1c2212325900cec5",
            measurementId: "G-N9G0HZM1NT"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- 204 ç­å­¸ç”Ÿåå–® (ä¿ç•™åŸè¨­å®š) ---
        const students = [{id:1, name:"ä½•ç¿ä¿¡"}, {id:2, name:"é™³æŸç¿°"}, {id:3, name:"é»ƒæ˜ç’¿"}, {id:4, name:"é»ƒå‰‡å–„"}, {id:5, name:"é»ƒæšç¿°"}, {id:6, name:"åŠ‰æ ¢ç¿"}, {id:7, name:"æ—èŠŠæƒ "}, {id:8, name:"æ®µå­Ÿæ¶µ"}, {id:9, name:"æ´ªç…œæ™´"}, {id:10, name:"å¼µè‚²æ…ˆ"}, {id:11, name:"è¨±ä»¤éœ"}, {id:12, name:"å»–ä»¥æ™¨"}, {id:13, name:"åŠ‰æ™å¦¤"}];
        
        const sel = document.getElementById('student-sel');
        students.forEach(s => {
            const opt = document.createElement('option');
            opt.value = s.id;
            opt.textContent = `${s.id}. ${s.name}`;
            sel.appendChild(opt);
        });

        // --- ç°½åè¦–çª—é‚è¼¯ ---
        const sigOverlay = document.getElementById('sig-overlay');
        const canvas = document.getElementById('canvas');
        
        // åˆå§‹åŒ–ç°½åæ¿
        const pad = new SignaturePad(canvas, {
            minWidth: 3,
            maxWidth: 5,
            penColor: 'rgb(0, 0, 0)'
        });
        
        const previewImg = document.getElementById('sig-preview');
        let isEraser = false;

        window.openSignature = () => {
            sigOverlay.style.display = 'flex';
            resizeCanvas();
            document.body.style.overflow = 'hidden'; 
            
            // é‡ç½®ç‚ºç•«ç­†æ¨¡å¼
            isEraser = false;
            pad.compositeOperation = 'source-over';
            const btn = document.getElementById('eraser-btn');
            btn.style.background = '#666';
            btn.textContent = 'ğŸ§½ æ©¡çš®æ“¦';
            
            // é‡ç½®ç²—ç´°
            const slider = document.querySelector('input[type="range"]');
            window.changeWidth(slider.value);
        };

        window.closeSignature = (save) => {
            if (save && !pad.isEmpty()) {
                previewImg.src = pad.toDataURL();
                previewImg.style.display = 'block';
                document.getElementById('sig-placeholder').style.display = 'none';
            }
            sigOverlay.style.display = 'none';
            document.body.style.overflow = 'auto';
        };

        window.toggleEraser = () => {
            isEraser = !isEraser;
            const btn = document.getElementById('eraser-btn');
            const slider = document.querySelector('input[type="range"]');
            
            if (isEraser) {
                pad.compositeOperation = 'destination-out';
                btn.style.background = '#ff4444';
                btn.textContent = 'âœï¸ åˆ‡æ›ç•«ç­†';
                pad.minWidth = 10;
                pad.maxWidth = 20;
            } else {
                pad.compositeOperation = 'source-over';
                btn.style.background = '#666';
                btn.textContent = 'ğŸ§½ æ©¡çš®æ“¦';
                window.changeWidth(slider.value);
            }
        };

        window.changeWidth = (val) => {
            if (!isEraser) {
                pad.minWidth = parseFloat(val);
                pad.maxWidth = parseFloat(val) + 2;
            }
        };

        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
            pad.clear();
        }

        function getFormattedDate() {
            const now = new Date();
            const days = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            return `${now.toLocaleDateString('zh-TW')} ${days[now.getDay()]}`;
        }

        // --- ã€å·²ä¿®æ­£ã€‘çµ±è¨ˆæ™‚æ®µé‚è¼¯ ---
        // ä¿®æ­£é‡é»ï¼šç¢ºä¿æ—¥æœŸè¨ˆç®—æ­£ç¢ºï¼Œæœ€å¾Œæ‰å›å‚³ Timestamp æ•¸å­—
        function getStatisticsRange() {
            const now = new Date();
            const day = now.getDay(); 
            let start = new Date(now);
            let end = new Date(now);
            
            // ä¿®æ­£é»ï¼šé€™è£¡åªè¨­å®šæ™‚é–“ï¼Œè¿”å› Date ç‰©ä»¶æœ¬èº«
            const setTime = (d, h) => { d.setHours(h, 0, 0, 0); return d; };

            // é€±äº” 16:00 ~ é€±ä¸€ 12:00
            const isWeekendWindow = (day === 5 && now.getHours() >= 16) || (day === 6) || (day === 0) || (day === 1 && now.getHours() < 12);

            if (isWeekendWindow) {
                if (day === 5) {
                    setTime(start, 16);
                } else if (day === 6) { 
                    start.setDate(start.getDate() - 1); 
                    setTime(start, 16); 
                } else if (day === 0) { 
                    start.setDate(start.getDate() - 2); 
                    setTime(start, 16); 
                } else if (day === 1) { 
                    start.setDate(start.getDate() - 3); 
                    setTime(start, 16); 
                }
                end = new Date(start); 
                end.setDate(start.getDate() + 3); 
                setTime(end, 12); 
            } else {
                // å¹³æ—¥ 16:00 ~ éš”æ—¥ 12:00
                if (now.getHours() >= 16) { 
                    setTime(start, 16);
                    end = new Date(start); 
                    end.setDate(end.getDate() + 1); 
                    setTime(end, 12);
                } else {
                    start.setDate(start.getDate() - 1); 
                    setTime(start, 16);
                    end = new Date(now);
                    setTime(end, 12);
                }
            }
            return { start: start.getTime(), end: end.getTime() };
        }

        let currentHomeworkContent = "";

        // è®€å–ä»Šæ—¥åŠŸèª²
        onSnapshot(doc(db, "configs", "today_homework"), (docSnap) => {
            if (docSnap.exists()) {
                currentHomeworkContent = docSnap.data().content || "";
                document.getElementById('hw-content').innerText = currentHomeworkContent;
                document.getElementById('hw-date').innerText = docSnap.data().date || getFormattedDate();
                
                const inputArea = document.getElementById('hw-input');
                if (inputArea && inputArea.value === "") {
                     inputArea.value = currentHomeworkContent;
                }
            }
        });

        window.saveData = async () => {
            const sid = sel.value;
            if(!sid || previewImg.style.display === 'none') return alert("è«‹é¸å–åº§è™Ÿä¸¦å®Œæˆæ‰‹å¯«ç°½å");
            try {
                await addDoc(collection(db, "signatures"), {
                    sid: sid,
                    name: students.find(s => s.id == sid).name,
                    comment: document.getElementById('comment').value,
                    sig: previewImg.src,
                    time: new Date().toLocaleString('zh-TW'),
                    timestamp: Date.now()
                });
                alert("å„²å­˜æˆåŠŸï¼");
                pad.clear();
                previewImg.style.display = 'none';
                document.getElementById('sig-placeholder').style.display = 'block';
                document.getElementById('comment').value = '';
            } catch(e) { alert("å„²å­˜å¤±æ•—ï¼š" + e.message); }
        };

        window.updateHW = async () => {
            const val = document.getElementById('hw-input').value;
            if(!val) return alert("è«‹è¼¸å…¥å…§å®¹");
            
            const currentBoardDate = document.getElementById('hw-date').innerText;
            const currentBoardContent = document.getElementById('hw-content').innerText;
            const newDate = getFormattedDate();

            try {
                if (currentBoardDate !== newDate && currentBoardDate !== "è¼‰å…¥ä¸­...") {
                    await addDoc(collection(db, "history_homework"), {
                        date: currentBoardDate,
                        content: currentBoardContent,
                        timestamp: Date.now()
                    });
                }
                await setDoc(doc(db, "configs", "today_homework"), {
                    content: val,
                    date: newDate
                });
                alert("åŠŸèª²å·²æ›´æ–°ï¼");
            } catch(e) { alert("æ›´æ–°å¤±æ•—ï¼š" + e.message); }
        };

        // --- ç®¡ç†å“¡ç™»å…¥ (ä¿ç•™ 204 å¯†ç¢¼) ---
        window.loginAdmin = () => {
            const pw = prompt("è«‹è¼¸å…¥ç®¡ç†å¯†ç¢¼ï¼š");
            const adminPanel = document.getElementById('admin-panel');
            const teacherExtra = document.getElementById('teacher-extra');

            if (pw === "0904") {
                // 204 è€å¸«æ¬Šé™
                adminPanel.style.display = 'block';
                teacherExtra.style.display = 'block';
                document.getElementById('hw-input').value = currentHomeworkContent;
                
                // ç«‹å³åˆå§‹åŒ–è³‡æ–™è®€å– (å»¶é²ä¸€é»é»ç¢ºä¿ä»‹é¢å·²é¡¯ç¤º)
                setTimeout(initAdminListeners, 500);
                
                adminPanel.scrollIntoView({ behavior: 'smooth' });
            } else if (pw === "0214") {
                // 204 å¹¹éƒ¨æ¬Šé™
                adminPanel.style.display = 'block';
                teacherExtra.style.display = 'none'; 
                document.getElementById('hw-input').value = currentHomeworkContent;
                adminPanel.scrollIntoView({ behavior: 'smooth' });
            } else {
                alert("å¯†ç¢¼éŒ¯èª¤ï¼");
            }
        };

        // --- ä¿®å¾©ç‰ˆï¼šè³‡æ–™è®€å–é‚è¼¯ ---
        function initAdminListeners() {
            console.log("é–‹å§‹è®€å–ç®¡ç†è³‡æ–™...");
            const statsArea = document.getElementById('stats-area');
            const recordsList = document.getElementById('records-list');
            const historyArea = document.getElementById('admin-history-manage');

            statsArea.innerHTML = '<div style="color:blue;">æ­£åœ¨é€£ç·šè‡³è³‡æ–™åº«...</div>';
            recordsList.innerHTML = '<div style="color:blue;">æ­£åœ¨è®€å–ç´€éŒ„...</div>';

            // 1. æ­·å²åŠŸèª²è®€å– (ä½¿ç”¨å‰ç«¯æ’åº)
            onSnapshot(collection(db, "history_homework"), (snap) => {
                const docs = snap.docs.map(d => ({id: d.id, ...d.data()}));
                docs.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

                if(docs.length === 0) {
                     historyArea.innerHTML = "ç„¡æ­·å²ç´€éŒ„";
                } else {
                    historyArea.innerHTML = docs.map(d => `
                        <div class="edit-card">
                            <small>${d.date}</small>
                            <textarea id="edit-${d.id}" style="width:100%; margin:5px 0;">${d.content}</textarea>
                            <button onclick="window.saveEditHW('${d.id}')">å„²å­˜ä¿®æ”¹</button>
                            <button onclick="window.deleteHW('${d.id}')" style="color:red;">åˆªé™¤</button>
                        </div>
                    `).join('');
                }
            }, (error) => {
                console.error("æ­·å²åŠŸèª²è®€å–å¤±æ•—:", error);
                historyArea.innerHTML = `<div style="color:red;">è®€å–å¤±æ•—ï¼š${error.message}</div>`;
            });

            // 2. ç°½åç´€éŒ„è®€å– (ä½¿ç”¨å‰ç«¯æ’åº + é˜²å‘†)
            onSnapshot(collection(db, "signatures"), (snap) => {
                try {
                    // éæ¿¾ç„¡æ•ˆè³‡æ–™
                    let allData = [];
                    snap.docs.forEach(d => {
                        const data = d.data();
                        if (data && data.timestamp) {
                            allData.push({ id: d.id, ...data });
                        }
                    });

                    // å‰ç«¯æ’åº
                    allData.sort((a, b) => b.timestamp - a.timestamp);

                    const range = getStatisticsRange(); // ç¾åœ¨é€™å€‹å‡½å¼æ˜¯ä¿®å¾©éçš„ï¼Œä¸æœƒå ±éŒ¯

                    // --- æ¸²æŸ“æ¸…å–® ---
                    const batchControlHTML = `
                        <div style="margin-bottom: 10px; padding: 10px; background: #eee; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
                            <label style="cursor:pointer; display:flex; align-items:center; gap:5px; margin:0;">
                                <input type="checkbox" id="selectAllSigs" onchange="window.toggleAllSigs(this)" style="transform: scale(1.3);"> 
                                å…¨é¸
                            </label>
                            <button onclick="window.deleteSelectedSigs()" style="background: #d32f2f; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-weight: bold;">ğŸ—‘ï¸ åˆªé™¤é¸å–é …ç›®</button>
                        </div>
                    `;

                    if (allData.length === 0) {
                        recordsList.innerHTML = `<div style="text-align:center; padding:20px; color:#888;">è³‡æ–™åº«ç›®å‰æ˜¯ç©ºçš„</div>`;
                    } else {
                        const listHTML = allData.map(d => {
                            const isOutside = (d.timestamp < range.start || d.timestamp >= range.end);
                            return `
                            <div class="record-card" style="${isOutside ? 'opacity:0.6; border-style:dashed; background:#fafafa;' : 'border-left:4px solid #4caf50;'}">
                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <b>${d.sid}. ${d.name}</b>
                                    <input type="checkbox" class="sig-checkbox" value="${d.id}" style="transform: scale(1.5); cursor: pointer;">
                                </div>
                                ${isOutside ? '<span style="color:#999; font-size:0.8em;">[éæœ¬æ¬¡çµ±è¨ˆ]</span><br>' : ''}
                                <small style="color:#888;">${d.time}</small><br>
                                <div style="margin:5px 0; color:#444;">ç•™è¨€ï¼š${d.comment || 'ç„¡'}</div>
                                <img src="${d.sig}" style="width:100%; border:1px solid #eee; background:#fff; margin-top:5px;">
                                <div style="text-align:right; margin-top:5px;">
                                    <button onclick="window.deleteSig('${d.id}')" style="color:#666; background:none; border:none; cursor:pointer; font-size:12px; text-decoration:underline;">å€‹åˆ¥åˆªé™¤</button>
                                </div>
                            </div>`;
                        }).join('');
                        recordsList.innerHTML = batchControlHTML + listHTML;
                    }

                    // --- è¨ˆç®—çµ±è¨ˆ ---
                    try {
                        const statsRecords = allData.filter(r => r.timestamp >= range.start && r.timestamp < range.end);
                        const signedIds = statsRecords.map(r => parseInt(r.sid));
                        const unsigned = students.filter(s => !signedIds.includes(s.id));

                        statsArea.innerHTML = `
                            <div style="background:#e3f2fd; padding:15px; border-radius:8px; margin-bottom:15px; border-left:5px solid #2196F3;">
                                <b style="color:#1565C0;">ğŸ“Š çµ±è¨ˆæ™‚æ®µï¼š</b><br>
                                ${new Date(range.start).toLocaleString()} ~ ${new Date(range.end).toLocaleString()}
                            </div>
                            <div style="background:#fff1f1; padding:15px; border-radius:8px; border-left:5px solid #f44336;">
                                <b style="color:#c62828;">âŒ æœ¬æ™‚æ®µæœªç°½å (${unsigned.length}äºº)ï¼š</b><br>
                                <p style="margin-top:8px; font-size:1.1em;">${unsigned.length > 0 ? unsigned.map(s => s.name).join('ã€') : 'âœ¨ å…¨ç­å·²ç°½å'}</p>
                            </div>`;
                    } catch (statError) {
                        console.error("çµ±è¨ˆè¨ˆç®—éŒ¯èª¤:", statError);
                        statsArea.innerHTML = `<div style="color:orange;">çµ±è¨ˆè¨ˆç®—ç•°å¸¸ï¼š${statError.message}</div>`;
                    }

                } catch (e) {
                    console.error("è³‡æ–™è™•ç†åš´é‡éŒ¯èª¤:", e);
                    statsArea.innerHTML = `<div style="color:red;">è³‡æ–™è™•ç†éŒ¯èª¤ï¼š${e.message}</div>`;
                    recordsList.innerHTML = "ç„¡æ³•é¡¯ç¤ºåˆ—è¡¨ï¼Œè«‹æª¢æŸ¥æ§åˆ¶å° (Console) éŒ¯èª¤è¨Šæ¯";
                }
            }, (error) => {
                console.error("ç°½åç´€éŒ„è®€å–å¤±æ•—:", error);
                recordsList.innerHTML = `<div style="color:red; padding:10px; border:1px solid red; background:#fff0f0;">
                    <b>è®€å–å¤±æ•—ï¼</b><br>
                    åŸå› ï¼š${error.code}<br>
                    è¨Šæ¯ï¼š${error.message}<br><br>
                    æç¤ºï¼šè«‹æª¢æŸ¥ Firebase Console > Firestore Database > Rules (è¦å‰‡)ã€‚
                </div>`;
                statsArea.innerHTML = "";
            });
        }

        window.toggleAllSigs = (source) => {
            const checkboxes = document.querySelectorAll('.sig-checkbox');
            checkboxes.forEach(cb => cb.checked = source.checked);
        };

        window.deleteSelectedSigs = async () => {
            const checkedBoxes = document.querySelectorAll('.sig-checkbox:checked');
            if (checkedBoxes.length === 0) return alert("è«‹å…ˆé¸å–è¦åˆªé™¤çš„é …ç›®");
            
            if (!confirm(`âš ï¸ ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤é¸å–çš„ ${checkedBoxes.length} ç­†ç°½åå—ï¼Ÿ\næ­¤å‹•ä½œç„¡æ³•å¾©åŸï¼`)) return;

            try {
                const deletePromises = Array.from(checkedBoxes).map(cb => deleteDoc(doc(db, "signatures", cb.value)));
                await Promise.all(deletePromises);
                alert("åˆªé™¤æˆåŠŸï¼");
                const selectAllBox = document.getElementById('selectAllSigs');
                if(selectAllBox) selectAllBox.checked = false;
            } catch (e) { alert("åˆªé™¤å¤±æ•—ï¼š" + e.message); }
        };

        window.saveEditHW = async (id) => {
            const newContent = document.getElementById(`edit-${id}`).value;
            await updateDoc(doc(db, "history_homework", id), { content: newContent });
            alert("å·²ä¿®æ­£");
        };
        window.deleteHW = async (id) => {
            if(confirm("ç¢ºå®šåˆªé™¤åŠŸèª²æ­·å²ï¼Ÿ")) await deleteDoc(doc(db, "history_homework", id));
        };
        window.deleteSig = async (id) => {
            if(confirm("ç¢ºå®šæ°¸ä¹…åˆªé™¤æ­¤ç°½åç´€éŒ„ï¼Ÿ")) await deleteDoc(doc(db, "signatures", id));
        };
        
        window.toggleHistory = () => {
            const box = document.getElementById('history-box');
            if (box.style.display === 'block') {
                box.style.display = 'none';
            } else {
                onSnapshot(collection(db, "history_homework"), (snap) => {
                    const docs = snap.docs.map(d => ({id: d.id, ...d.data()}));
                    docs.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                    box.innerHTML = docs.map(d => `<div class="hist-item"><b>${d.date}</b><br>${d.content}</div>`).join('');
                });
                box.style.display = 'block';
            }
        };

        window.onresize = resizeCanvas;
    </script>

    <style>
        :root { --muji-bg: #f2f0eb; --blackboard-green: #2c4c3e; --chalk-white: #fdfdfd; --muji-charcoal: #333333; }
        * { box-sizing: border-box; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--muji-bg); color: var(--muji-charcoal); margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .blackboard { background-color: var(--blackboard-green); border: 12px solid #5d4037; border-radius: 4px; padding: 20px; text-align: center; margin-top: 20px; }
        .bb-title { color: #ffd54f; font-size: 1.8em; font-weight: 700; }
        .bb-date { color: rgba(255,255,255,0.8); margin-bottom: 10px; border-bottom: 1px dashed rgba(255,255,255,0.3); padding-bottom: 10px; }
        .homework-content { color: var(--chalk-white); font-size: 1.3em; line-height: 1.6; text-align: left; white-space: pre-wrap; min-height: 80px; }
        .btn { background-color: var(--muji-charcoal); color: white; border: none; padding: 18px; cursor: pointer; width: 100%; font-size: 20px; border-radius: 6px; font-weight: 700; margin-top: 10px; }
        .btn-history { background: none; border: 2px solid #888; color: #888; font-size: 16px; height: 50px; }
        #history-box { display: none; padding: 15px; background: #f9f9f9; border-radius: 4px; border: 1px solid #ddd; margin-top: 10px; }
        .hist-item { border-bottom: 1px solid #eee; padding: 10px 0; font-size: 0.9em; }
        .admin-area { display: none; margin-top: 40px; padding: 20px; background: #eef2f3; border-radius: 8px; border: 2px solid #ccc; }
        .record-card, .edit-card { background: white; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .sig-preview-box { border: 2px dashed #bbb; background: #fafafa; border-radius: 6px; min-height: 120px; display: flex; align-items: center; justify-content: center; cursor: pointer; margin-top: 10px; overflow: hidden; }
        .sig-preview-box img { max-height: 150px; }
        #sig-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 1000; display: none; flex-direction: column; }
        .sig-header { padding: 15px; background: #f2f0eb; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; }
        .sig-controls { padding: 10px; background: #eee; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; justify-content: center; }
        .sig-canvas-wrap { flex: 1; position: relative; background: #fff; cursor: crosshair; }
        canvas { width: 100%; height: 100%; touch-action: none; }
        .control-btn { padding: 8px 15px; border: none; border-radius: 4px; color: white; cursor: pointer; font-weight: bold; }
        label { font-weight: 700; display: block; margin-top: 15px; }
    </style>
</head>
<body>
<div class="container">
    <div style="text-align: center;">
        <h2 style="margin:0;">å¤§å‰åœ‹ä¸­ äºŒå¹´å››ç­</h2>
        <h1 style="margin:5px 0 20px 0;">ç·šä¸Šè¯çµ¡ç°¿</h1>
    </div>

    <div class="blackboard">
        <div class="bb-title">ä»Šæ—¥åŠŸèª²</div>
        <div class="bb-date" id="hw-date">è¼‰å…¥ä¸­...</div>
        <div id="hw-content" class="homework-content">è¼‰å…¥ä¸­...</div>
    </div>

    <button class="btn btn-history" onclick="toggleHistory()">ğŸ“‚ æŸ¥çœ‹æ­·å²åŠŸèª² (å±•é–‹/æ”¶èµ·)</button>
    <div id="history-box"></div>

    <hr style="margin: 30px 0; border: 0; border-top: 2px solid #eee;">

    <h3 style="border-left: 6px solid #333; padding-left: 12px;">å®¶é•·ç°½åå€åŸŸ</h3>
    
    <label>1. é¸æ“‡å­¸ç”Ÿåº§è™Ÿ</label>
    <select id="student-sel" style="width:100%; padding:14px; font-size:18px; border-radius:6px; border:1px solid #ccc;"></select>

    <label>2. å®¶é•·ç•™è¨€ (é¸å¡«)</label>
    <textarea id="comment" rows="2" style="width:100%; padding:14px; font-size:18px; border-radius:6px; border:1px solid #ccc;"></textarea>

    <label>3. å®¶é•·æ‰‹å¯«ç°½å</label>
    <div class="sig-preview-box" onclick="openSignature()">
        <span id="sig-placeholder" style="color: #888;">é»æ“Šæ­¤è™•é–‹å•Ÿç°½åç•«é¢</span>
        <img id="sig-preview" src="" style="display: none;">
    </div>

    <button class="btn" onclick="saveData()">ç¢ºèªå„²å­˜ä¸¦é€å‡º</button>

    <button onclick="loginAdmin()" style="margin-top:80px; opacity:0.1; background:none; border:none; width:100%; cursor:default;">ç®¡ç†</button>

    <div id="admin-panel" class="admin-area">
        <h2 style="text-align:center; color:#333;">æ•™å¸«/å¹¹éƒ¨ç®¡ç†å¾Œå°</h2>
        <label>ç™¼å¸ƒæ–°åŠŸèª²å…§å®¹</label>
        <textarea id="hw-input" rows="4" style="width:100%; padding:10px; margin-bottom:10px; border-radius:6px; border:1px solid #bbb;"></textarea>
        <button class="btn" style="background:#444;" onclick="updateHW()">æ›´æ–°é»‘æ¿å…§å®¹</button>
        <div id="teacher-extra">
            <hr style="margin:25px 0;">
            <h3>ğŸ“Š å®¶é•·ç°½åçµ±è¨ˆ</h3>
            <div id="stats-area">æ­£åœ¨è¨ˆç®—çµ±è¨ˆæ•¸æ“š...</div>
            <h3 style="margin-top:30px;">ğŸ“‹ å®Œæ•´æ­·å²ç°½åç´€éŒ„</h3>
            <div id="records-list"></div>
            <hr style="margin:25px 0;">
            <h3>âœï¸ ä¿®æ­£æ­·å²åŠŸèª²</h3>
            <div id="admin-history-manage"></div>
        </div>
    </div>
</div>

<div id="sig-overlay">
    <div class="sig-header">
        <button onclick="closeSignature(false)" style="background: #ccc; border:none; padding:10px; border-radius:5px;">å–æ¶ˆ</button>
        <strong style="font-size: 1.2em;">å®¶é•·ç°½åç•«é¢</strong>
        <button onclick="closeSignature(true)" style="background: #333; color:white; border:none; padding:10px 20px; border-radius:5px;">å®Œæˆ</button>
    </div>
    <div class="sig-controls">
        <div style="display:flex; align-items:center; gap:5px;">
            <small>ç²—ç´°:</small>
            <input type="range" min="1" max="10" value="3" oninput="changeWidth(this.value)">
        </div>
        <button id="eraser-btn" class="control-btn" style="background: #666;" onclick="toggleEraser()">ğŸ§½ æ©¡çš®æ“¦</button>
        <button class="control-btn" style="background: #888;" onclick="pad.clear()">ğŸ—‘ï¸ å…¨éƒ¨æ¸…é™¤</button>
    </div>
    <div class="sig-canvas-wrap">
        <canvas id="canvas"></canvas>
    </div>
    <div style="padding: 10px; text-align: center; color: #666; font-size: 0.9em; background: #f9f9f9;">
        è«‹åœ¨ç©ºç™½è™•æ›¸å¯«å§“å
    </div>
</div>

</body>
</html>
