<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å‰åœ‹ä¸­ 204 é›»å­è¯çµ¡ç°¿</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        :root { --muji-bg: #f2f0eb; --muji-stone: #e0dbd1; --muji-charcoal: #333333; --muji-accent: #8c8c8c; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--muji-bg); color: var(--muji-charcoal); margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h1, h2 { text-align: center; font-weight: 500; margin-bottom: 15px; }
        .school-info { font-size: 0.8em; color: var(--muji-accent); text-align: center; letter-spacing: 2px; margin-bottom: 5px; }
        .section { border-bottom: 1px solid var(--muji-stone); padding: 20px 0; }
        .homework-box { background: #fafafa; padding: 15px; border-radius: 4px; border-left: 5px solid var(--muji-accent); min-height: 60px; white-space: pre-wrap; margin-bottom: 10px; }
        .history-btn { background: none; border: 1px solid var(--muji-stone); color: var(--muji-accent); padding: 8px 15px; cursor: pointer; border-radius: 4px; font-size: 0.9em; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid var(--muji-stone); border-radius: 4px; box-sizing: border-box; font-size: 16px; font-family: inherit; }
        canvas { border: 1px solid var(--muji-stone); background: #fff; width: 100%; height: 200px; touch-action: none; border-radius: 4px; }
        .btn { background-color: var(--muji-charcoal); color: white; border: none; padding: 14px; cursor: pointer; width: 100%; font-size: 16px; border-radius: 4px; margin-top: 10px; }
        .admin-area { display: none; background: #f9f9f9; padding: 15px; border: 1px solid var(--muji-stone); margin-top: 20px; border-radius: 4px; }
        .record-card { background: white; border: 1px solid var(--muji-stone); padding: 12px; margin-bottom: 10px; border-radius: 4px; }
        .delete-btn { color: #d9534f; cursor: pointer; font-size: 0.85em; background: none; border: none; padding: 0; text-decoration: underline; margin-top: 8px; }
        .unsigned-box { background: #fff1f1; border: 1px solid #f5c6cb; color: #721c24; padding: 10px; border-radius: 4px; margin-bottom: 15px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">
    <div class="school-info">å¤§å‰åœ‹ä¸­ äºŒå¹´å››ç­</div>
    <h1>é›»å­è¯çµ¡ç°¿</h1>

    <div class="section">
        <h2 id="hw-title">ä»Šæ—¥åŠŸèª²</h2>
        <div id="homework-display" class="homework-box">è®€å–ä¸­...</div>
        <button class="history-btn" onclick="showHistory()">ğŸ“‚ æŸ¥çœ‹ä¹‹å‰åŠŸèª²</button>
    </div>

    <div class="section">
        <h2>å®¶é•·ç°½å</h2>
        <div class="input-group">
            <label>1. é¸æ“‡å­¸ç”Ÿ</label>
            <select id="student-select">
                <option value="">è«‹é¸æ“‡åº§è™Ÿå§“å</option>
            </select>
        </div>
        <div class="input-group">
            <label>2. æƒ³è·Ÿè€å¸«èªªçš„è©±</label>
            <textarea id="parent-comment" placeholder="è‹¥æœ‰äº‹æƒ³èˆ‡é‚±è€å¸«æºé€šè«‹å¯«åœ¨æ­¤è™•ï¼ˆé¸å¡«ï¼‰"></textarea>
        </div>
        <div class="input-group">
            <label>3. å®¶é•·æ‰‹å¯«ç°½å</label>
            <canvas id="signature-pad"></canvas>
            <button onclick="signaturePad.clear()" style="font-size:12px; background:none; border:none; color:gray; text-decoration:underline; cursor:pointer;">æ¸…é™¤é‡ç°½</button>
        </div>
        <button class="btn" onclick="saveSignature()">å„²å­˜ç°½åä¸¦é€å‡º</button>
    </div>

    <button onclick="openAdmin()" style="background:none; border:none; color:var(--muji-stone); width:100%; margin-top:50px; cursor:pointer; font-size:0.7em;">è€å¸«ç«¯ç®¡ç†</button>

    <div id="admin-panel" class="admin-area">
        <h3>è€å¸«ç®¡ç†å¾Œå°</h3>
        <div class="input-group">
            <label>ç™¼å¸ƒæ–°åŠŸèª²</label>
            <textarea id="admin-hw-input" rows="4" placeholder="è«‹è¼¸å…¥ä»Šæ—¥åŠŸèª²å…§å®¹..."></textarea>
            <button class="btn" onclick="publishHomework()">ç™¼å¸ƒä¸¦å­˜æª”</button>
        </div>
        <hr>
        <h4>ä»Šæ—¥å®¶é•·ç°½åçµ±è¨ˆ</h4>
        <div id="stats-display"></div>
        <div id="records-display"></div>
    </div>
</div>

<script>
    const students = [
        {id:1, name:"ä½•ç¿ä¿¡"}, {id:2, name:"é™³æŸç¿°"}, {id:3, name:"é»ƒæ˜ç’¿"},
        {id:4, name:"é»ƒå‰‡å–„"}, {id:5, name:"é»ƒæšç¿°"}, {id:6, name:"åŠ‰æ ¢ç¿"},
        {id:7, name:"æ—èŠŠæƒ "}, {id:8, name:"æ®µå­Ÿæ¶µ"}, {id:9, name:"æ´ªç…œæ™´"},
        {id:10, name:"å¼µè‚²æ…ˆ"}, {id:11, name:"è¨±ä»¤éœ"}, {id:12, name:"å»–ä»¥æ™¨"},
        {id:13, name:"åŠ‰æ™å¦¤"}
    ];

    // åˆå§‹åŒ–ä¸‹æ‹‰é¸å–®
    const sel = document.getElementById('student-select');
    students.forEach(s => sel.innerHTML += `<option value="${s.id}">${s.id}. ${s.name}</option>`);

    // åˆå§‹åŒ–ç°½åæ¿
    const canvas = document.getElementById('signature-pad');
    const signaturePad = new SignaturePad(canvas);

    function getToday() { return new Date().toLocaleDateString('zh-TW').replace(/\//g, '-'); }
    document.getElementById('hw-title').innerText = `ä»Šæ—¥åŠŸèª² (${getToday()})`;

    // --- å®¶é•·ç«¯æ“ä½œ ---
    function saveSignature() {
        const sId = document.getElementById('student-select').value;
        if (!sId || signaturePad.isEmpty()) return alert("è«‹é¸å–å­¸ç”Ÿä¸¦å®Œæˆç°½åå–”ï¼");

        const now = new Date();
        const data = {
            id: Date.now(), // å”¯ä¸€ç¢¼
            studentId: sId,
            studentName: students.find(s => s.id == sId).name,
            comment: document.getElementById('parent-comment').value,
            signature: signaturePad.toDataURL(),
            date: getToday(),
            time: now.toLocaleTimeString('zh-TW', {hour12:false})
        };

        console.log("å·²ç´€éŒ„è³‡æ–™ï¼š", data);
        alert(`ç°½åå·²å„²å­˜ï¼\næ™‚é–“ï¼š${data.date} ${data.time}`);
        signaturePad.clear();
        document.getElementById('parent-comment').value = '';
    }

    // --- è€å¸«ç«¯æ“ä½œ ---
    function openAdmin() {
        if(prompt("è«‹è¼¸å…¥å¯†ç¢¼ï¼š") === "0904") {
            document.getElementById('admin-panel').style.display = 'block';
            refreshStats();
        } else {
            alert("å¯†ç¢¼ä¸æ­£ç¢º");
        }
    }

    function publishHomework() {
        const content = document.getElementById('admin-hw-input').value;
        if(!content) return alert("è«‹è¼¸å…¥åŠŸèª²å…§å®¹");
        document.getElementById('homework-display').innerText = content;
        alert(`ä»Šæ—¥ (${getToday()}) åŠŸèª²å·²ç™¼å¸ƒä¸¦è‡ªå‹•ç•™å­˜ã€‚`);
    }

    function showHistory() {
        const d = prompt("è«‹è¼¸å…¥æ¬²æŸ¥çœ‹çš„æ—¥æœŸï¼ˆå¦‚ 2026-01-29ï¼‰ï¼š", getToday());
        if(d) alert(`æ­£åœ¨èª¿é–± ${d} çš„æ­·å²åŠŸèª²...`);
    }

    function refreshStats() {
        // æ¨¡æ“¬çµ±è¨ˆé‚è¼¯
        const signedIds = [1, 3]; // ç¯„ä¾‹è³‡æ–™
        const unsigned = students.filter(s => !signedIds.includes(s.id));
        
        let statsHtml = `
            <div class="unsigned-box">
                <strong>æœªç°½åå­¸ç”Ÿï¼š</strong><br>${unsigned.map(s => s.name).join('ã€')}
            </div>
            <p>å·²ç°½åï¼š${signedIds.length} äºº | æœªç°½åï¼š${unsigned.length} äºº</p>
        `;
        document.getElementById('stats-display').innerHTML = statsHtml;
    }

    function deleteRecord(id) {
        if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†å®¶é•·ç°½åç´€éŒ„å—ï¼Ÿ")) {
            alert("å·²åˆªé™¤ç´€éŒ„");
            // æ­¤è™•é€£å‹• Firebase åˆªé™¤
        }
    }
</script>
</body>
</html>
