<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å‰åœ‹ä¸­ 204 é›»å­è¯çµ¡ç°¿</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        :root { --muji-bg: #f2f0eb; --muji-stone: #e0dbd1; --muji-charcoal: #333333; --muji-accent: #8c8c8c; }
        * { box-sizing: border-box; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--muji-bg); color: var(--muji-charcoal); margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 25px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        /* æ¨™é¡Œæ”¾å¤§è¨­å®š */
        .school-info { font-size: 1.6em; font-weight: 700; color: var(--muji-charcoal); text-align: center; margin-bottom: 5px; letter-spacing: 1px; }
        h1 { font-size: 1.2em; color: var(--muji-accent); text-align: center; margin-top: 0; font-weight: 400; }
        
        h2 { font-size: 1.1em; font-weight: 500; border-left: 4px solid var(--muji-charcoal); padding-left: 10px; margin-bottom: 15px; }
        .section { border-bottom: 1px solid var(--muji-stone); padding: 20px 0; }
        
        .homework-box { background: #fafafa; padding: 15px; border-radius: 4px; border: 1px solid var(--muji-stone); min-height: 80px; white-space: pre-wrap; margin-bottom: 10px; line-height: 1.6; }
        .history-btn { background: none; border: 1px solid var(--muji-accent); color: var(--muji-accent); padding: 8px; cursor: pointer; border-radius: 4px; width: 100%; font-size: 0.9em; }

        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; }
        select, textarea { width: 100%; padding: 12px; border: 1px solid var(--muji-stone); border-radius: 4px; font-size: 16px; font-family: inherit; }
        
        .sig-wrapper { border: 1px solid var(--muji-stone); background: #fff; border-radius: 4px; margin-bottom: 5px; }
        canvas { width: 100%; height: 180px; touch-action: none; display: block; }
        
        .btn { background-color: var(--muji-charcoal); color: white; border: none; padding: 14px; cursor: pointer; width: 100%; font-size: 16px; border-radius: 4px; font-weight: 500; }
        
        /* è€å¸«ç®¡ç†å€å¡ç‰‡ */
        .admin-area { display: none; margin-top: 30px; padding: 20px; background: #f9f9f9; border-top: 3px solid var(--muji-charcoal); border-radius: 0 0 4px 4px; }
        .stats-box { background: #fff1f1; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 4px; margin-bottom: 20px; font-size: 0.95em; }
        .record-card { background: white; border: 1px solid var(--muji-stone); padding: 15px; margin-bottom: 15px; border-radius: 4px; }
        .record-header { display: flex; justify-content: space-between; border-bottom: 1px dashed #ddd; padding-bottom: 8px; margin-bottom: 10px; }
        .comment-display { background: #fdfdfd; padding: 10px; border: 1px solid #eee; border-radius: 4px; margin: 10px 0; font-size: 0.95em; }
        .sig-img { width: 100%; background: #fff; border: 1px solid #eee; display: block; }
        .delete-btn { color: #d9534f; background: none; border: none; text-decoration: underline; cursor: pointer; margin-top: 10px; font-size: 0.85em; width: 100%; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <div class="school-info">å¤§å‰åœ‹ä¸­ äºŒå¹´å››ç­</div>
    <h1>é›»å­è¯çµ¡ç°¿</h1>

    <div class="section">
        <h2 id="hw-title">ä»Šæ—¥åŠŸèª²</h2>
        <div id="hw-content" class="homework-box">è®€å–ä¸­...</div>
        <button class="history-btn" onclick="viewHistory()">ğŸ“‚ æŸ¥çœ‹ä¹‹å‰åŠŸèª²</button>
    </div>

    <div class="section">
        <h2>å®¶é•·ç°½å</h2>
        <div class="input-group">
            <label>1. é¸æ“‡å­¸ç”Ÿåº§è™Ÿå§“å</label>
            <select id="student-sel"><option value="">è«‹é¸æ“‡</option></select>
        </div>
        <div class="input-group">
            <label>2. æƒ³å°è€å¸«èªªçš„è©±</label>
            <textarea id="comment" rows="2" placeholder="é¸å¡«ï¼Œæœ‰äº‹è«‹ç•™è¨€"></textarea>
        </div>
        <div class="input-group">
            <label>3. å®¶é•·æ‰‹å¯«ç°½å</label>
            <div class="sig-wrapper"><canvas id="canvas"></canvas></div>
            <button onclick="pad.clear()" style="font-size:12px; background:none; border:none; text-decoration:underline; color:gray; cursor:pointer;">æ¸…é™¤é‡ç°½</button>
        </div>
        <button class="btn" onclick="saveSignature()">å„²å­˜ç°½åä¸¦é€å‡º</button>
    </div>

    <button onclick="loginAdmin()" style="margin-top:60px; background:none; border:none; color:#ddd; width:100%; cursor:pointer; font-size:10px;">è€å¸«ç«¯ç®¡ç†</button>

    <div id="admin-panel" class="admin-area">
        <h3>è€å¸«ç®¡ç†å¾Œå°</h3>
        <div class="input-group">
            <label>ç™¼å¸ƒä»Šæ—¥åŠŸèª² (ç³»çµ±æœƒè‡ªå‹•å°‡èˆŠåŠŸèª²å°å­˜)</label>
            <textarea id="hw-input" rows="3" placeholder="è«‹åœ¨æ­¤è¼¸å…¥æ–°åŠŸèª²..."></textarea>
            <button class="btn" style="background:#666;" onclick="updateHW()">æ›´æ–°ä¸¦ç™¼å¸ƒ</button>
        </div>
        <hr>
        <h4>ç°½åçµ±è¨ˆèˆ‡å®¶é•·ç•™è¨€</h4>
        <div id="stats-area"></div>
        <div id="records-area"></div>
    </div>
</div>

<script>
    const students = [
        {id:1, name:"ä½•ç¿ä¿¡"}, {id:2, name:"é™³æŸç¿°"}, {id:3, name:"é»ƒæ˜ç’¿"},
        {id:4, name:"é»ƒå‰‡å–„"}, {id:5, name:"é»ƒæšç¿°"}, {id:6, name:"åŠ‰æ ¢ç¿"},
        {id:7, name:"æ—èŠŠæƒ "}, {id:8, name:"æ®µå­Ÿæ¶µ"}, {id:9, name:"æ´ªç…œæ™´"},
        {id:10, name:"å¼µè‚²æ…ˆ"}, {id:11, name:"è¨±ä»¤éœ"}, {id:12, name:"å»–ä»¥æ™¨"},
        {id:13, name:"åŠ‰æ™å¦¤"}
    ];

    // åˆå§‹åŒ–å­¸ç”Ÿåå–®
    const sel = document.getElementById('student-sel');
    students.forEach(s => sel.innerHTML += `<option value="${s.id}">${s.id}. ${s.name}</option>`);

    // åˆå§‹åŒ–ç°½åæ¿
    const canvas = document.getElementById('canvas');
    const pad = new SignaturePad(canvas);
    
    // é è¨­åŠŸèª²å…§å®¹ (æ¨¡æ“¬å¾è³‡æ–™åº«è®€å–)
    let currentHW = "1. åœ‹ä½œç¬¬äº”èª² \n2. æ•¸ç¿’ P.45-47 \n3. æ˜è€ƒè‹±æ–‡å–®å­— U3";
    document.getElementById('hw-content').innerText = currentHW;

    // æ¨¡æ“¬æ­·å²è³‡æ–™åº«
    let historyHW = []; 
    let parentRecords = [];

    // --- åŠŸèƒ½é‚è¼¯ ---

    function viewHistory() {
        // ä¾ç…§è¦æ±‚é¡¯ç¤ºæ­£åœ¨è®€å–
        alert("æ­£åœ¨è®€å–æ­·å²è³‡æ–™...");
        // æ­¤è™•ä¸²æ¥ Firebase æ™‚æœƒå¯«å…¥ï¼šdb.collection('homework').get()...
    }

    function updateHW() {
        const newInput = document.getElementById('hw-input').value;
        if(!newInput) return alert("è«‹è¼¸å…¥åŠŸèª²å…§å®¹");

        // 1. å°‡èˆŠåŠŸèª²å„²å­˜åˆ°æ­·å²ç´€éŒ„ (æ¨¡æ“¬)
        const archiveDate = new Date().toLocaleDateString();
        historyHW.push({ date: archiveDate, content: currentHW });

        // 2. æ›´æ–°å…¬å‘ŠåŠŸèª²
        currentHW = newInput;
        document.getElementById('hw-content').innerText = currentHW;
        
        alert("å·²æˆåŠŸç™¼å¸ƒï¼\nèˆŠåŠŸèª²å…§å®¹å·²å­˜å…¥ã€Œä¹‹å‰çš„åŠŸèª²ã€ã€‚");
        document.getElementById('hw-input').value = '';
    }

    function saveSignature() {
        const sid = sel.value;
        if(!sid || pad.isEmpty()) return alert("è«‹å…ˆé¸æ“‡å­¸ç”Ÿä¸¦ç°½å");
        
        const record = {
            id: Date.now(),
            sid: sid,
            name: students.find(s => s.id == sid).name,
            comment: document.getElementById('comment').value,
            sig: pad.toDataURL(),
            time: new Date().toLocaleTimeString('zh-TW', {hour12:false})
        };
        
        parentRecords.push(record);
        alert("ç°½åå„²å­˜æˆåŠŸï¼å·²å‚³é€çµ¦é‚±è€å¸«ã€‚");
        pad.clear();
        document.getElementById('comment').value = '';
    }

    function loginAdmin() {
        if(prompt("è«‹è¼¸å…¥å¯†ç¢¼ï¼š") === "0904") {
            document.getElementById('admin-panel').style.display = 'block';
            renderAdminPanel();
        }
    }

    function renderAdminPanel() {
        // 1. çµ±è¨ˆèª°æ²’ç°½å
        const signedIds = parentRecords.map(r => parseInt(r.sid));
        const unsigned = students.filter(s => !signedIds.includes(s.id));
        
        document.getElementById('stats-area').innerHTML = `
            <div class="stats-box">
                <strong>æœªç°½åå­¸ç”Ÿåå–®ï¼š</strong><br>
                ${unsigned.length > 0 ? unsigned.map(s => s.name).join('ã€') : 'å…¨ç­éƒ½ç°½åå›‰ï¼'}
            </div>
            <p style="text-align:center; font-size:0.9em; color:#666;">é€²åº¦ï¼š${signedIds.length} / 13</p>
        `;

        // 2. é¡¯ç¤ºå®¶é•·ç•™è¨€èˆ‡ç°½ååœ–ç‰‡
        const area = document.getElementById('records-area');
        area.innerHTML = '';
        [...parentRecords].reverse().forEach(r => {
            area.innerHTML += `
                <div class="record-card">
                    <div class="record-header">
                        <strong>åº§è™Ÿ ${r.sid} ${r.name}</strong>
                        <span style="color:#999; font-size:0.8em;">${r.time}</span>
                    </div>
                    <div class="comment-display">${r.comment ? r.comment : '<span style="color:#ccc;">(ç„¡ç•™è¨€)</span>'}</div>
                    <img src="${r.sig}" class="sig-img">
                    <button class="delete-btn" onclick="deleteRec(${r.id})">åˆªé™¤æ­¤ç­†è¨˜éŒ„</button>
                </div>
            `;
        });
    }

    function deleteRec(id) {
        if(confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†ç°½åï¼Ÿ")) {
            parentRecords = parentRecords.filter(r => r.id !== id);
            renderAdminPanel();
        }
    }

    // æ ¼å¼åŒ–æ—¥æœŸæ¨™é¡Œ
    document.getElementById('hw-title').innerText = `ä»Šæ—¥åŠŸèª² (${new Date().toLocaleDateString('zh-TW')})`;
</script>

</body>
</html>
