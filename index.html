<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§å‰åœ‹ä¸­ 204 é›»å­è¯çµ¡ç°¿</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        :root { --muji-bg: #f2f0eb; --muji-stone: #e0dbd1; --muji-charcoal: #333333; --muji-accent: #8c8c8c; }
        * { box-sizing: border-box; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--muji-bg); color: var(--muji-charcoal); margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h1, h2 { text-align: center; font-weight: 500; }
        .school-info { font-size: 0.8em; color: var(--muji-accent); text-align: center; letter-spacing: 2px; }
        .section { border-bottom: 1px solid var(--muji-stone); padding: 20px 0; }
        .homework-box { background: #fafafa; padding: 15px; border-radius: 4px; border-left: 5px solid var(--muji-accent); min-height: 60px; white-space: pre-wrap; margin-bottom: 10px; }
        
        /* è¡¨å–®æ¨£å¼ */
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 500; }
        select, textarea { width: 100%; padding: 12px; border: 1px solid var(--muji-stone); border-radius: 4px; font-size: 16px; font-family: inherit; }
        .sig-wrapper { border: 1px solid var(--muji-stone); background: #fff; border-radius: 4px; }
        canvas { width: 100%; height: 180px; touch-action: none; display: block; }
        
        .btn { background-color: var(--muji-charcoal); color: white; border: none; padding: 14px; cursor: pointer; width: 100%; font-size: 16px; border-radius: 4px; }
        
        /* è€å¸«ç®¡ç†å€ */
        .admin-area { display: none; margin-top: 30px; padding: 20px; background: #f9f9f9; border-top: 2px solid var(--muji-charcoal); }
        .stats-box { background: #fff1f1; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 4px; margin-bottom: 20px; }
        .record-card { background: white; border: 1px solid var(--muji-stone); padding: 15px; margin-bottom: 15px; border-radius: 4px; }
        .record-header { display: flex; justify-content: space-between; border-bottom: 1px dashed #ddd; padding-bottom: 8px; margin-bottom: 10px; }
        .comment-text { background: #fdfdfd; padding: 10px; border: 1px solid #eee; border-radius: 4px; margin-bottom: 10px; font-size: 0.95em; }
        .sig-img { width: 100%; background: #fff; border: 1px solid #eee; }
        .delete-btn { color: #d9534f; background: none; border: none; text-decoration: underline; cursor: pointer; margin-top: 10px; font-size: 0.85em; width: 100%; text-align: right; }
    </style>
</head>
<body>

<div class="container">
    <div class="school-info">å¤§å‰åœ‹ä¸­ äºŒå¹´å››ç­</div>
    <h1>é›»å­è¯çµ¡ç°¿</h1>

    <div id="parent-view">
        <div class="section">
            <h2 id="today-date">ä»Šæ—¥åŠŸèª²</h2>
            <div id="hw-content" class="homework-box">å°šæœªè¼¸å…¥ä»Šæ—¥åŠŸèª²</div>
            <button onclick="viewHistory()" style="width:100%; background:none; border:1px solid #ccc; color:#888; padding:5px; border-radius:4px; cursor:pointer;">ğŸ“‚ æŸ¥çœ‹ä¹‹å‰åŠŸèª²</button>
        </div>

        <div class="section">
            <h2>å®¶é•·ç°½å</h2>
            <div class="input-group">
                <label>é¸æ“‡å­¸ç”Ÿ</label>
                <select id="student-sel"><option value="">è«‹é»æ“Šé¸æ“‡</option></select>
            </div>
            <div class="input-group">
                <label>æƒ³å°è€å¸«èªªçš„è©±</label>
                <textarea id="comment" rows="2" placeholder="é¸å¡«"></textarea>
            </div>
            <div class="input-group">
                <label>å®¶é•·ç°½åå€åŸŸ</label>
                <div class="sig-wrapper"><canvas id="canvas"></canvas></div>
                <button onclick="pad.clear()" style="font-size:12px; background:none; border:none; text-decoration:underline; color:gray; cursor:pointer;">æ¸…é™¤é‡ç°½</button>
            </div>
            <button class="btn" onclick="saveData()">å„²å­˜ç°½åä¸¦é€å‡º</button>
        </div>
    </div>

    <button onclick="loginAdmin()" style="margin-top:50px; background:none; border:none; color:#ddd; width:100%; cursor:pointer; font-size:10px;">è€å¸«ç®¡ç†ç«¯</button>

    <div id="admin-panel" class="admin-area">
        <h3>ç®¡ç†å¾Œå°</h3>
        <div class="input-group">
            <label>æ›´æ–°ä»Šæ—¥åŠŸèª²</label>
            <textarea id="hw-input" rows="3"></textarea>
            <button class="btn" style="background:#666;" onclick="updateHW()">ç™¼å¸ƒåŠŸèª²</button>
        </div>
        <hr>
        <h4>ç°½åˆ°çµ±è¨ˆèˆ‡ç•™è¨€</h4>
        <div id="stats-area"></div>
        <div id="records-area"></div>
    </div>
</div>

<script>
    const students = [
        {id:1, name:"ä½•ç¿ä¿¡"}, {id:2, name:"é™³æŸç¿°"}, {id:3, name:"é»ƒæ˜ç’¿"},
        {id:4, name:"é»ƒå‰‡å–„"}, {id:5, name:"é»ƒæšç¿°"}, {id:6, name:"åŠ‰æ ¢ç¿"},
        {id:7, name:"æ—èŠŠæƒ "}, {id:8, name:"æ®µå­Ÿæ¶µ"}, {id:9, name:"æ´ªç…œæ™´"},
        {id:10, name:"å¼µè‚²æ…ˆ"}, {id:11, name:"è¨±ä»¤éœ"}, {id:12, name:"å»–ä»¥æ™¨"},
        {id:13, name:"åŠ‰æ™å¦¤"}
    ];

    // åˆå§‹åŒ–åå–®
    const sel = document.getElementById('student-sel');
    students.forEach(s => sel.innerHTML += `<option value="${s.id}">${s.id}. ${s.name}</option>`);

    // åˆå§‹åŒ–ç°½åæ¿
    const canvas = document.getElementById('canvas');
    const pad = new SignaturePad(canvas);
    
    // æ¨¡æ“¬è³‡æ–™åº« (æœªä¾†å°æ¥ Firebase)
    let db_records = []; 

    function saveData() {
        const sid = sel.value;
        if(!sid || pad.isEmpty()) return alert("è«‹å…ˆé¸æ“‡å­¸ç”Ÿä¸¦ç°½å");
        
        const newRecord = {
            id: Date.now(),
            sid: sid,
            name: students.find(s => s.id == sid).name,
            comment: document.getElementById('comment').value,
            sig: pad.toDataURL(),
            date: new Date().toLocaleDateString(),
            time: new Date().toLocaleTimeString('zh-TW', {hour12:false})
        };
        
        db_records.push(newRecord); // æ¨¡æ“¬å¯«å…¥
        alert("ç°½åå„²å­˜æˆåŠŸï¼æ™‚é–“ï¼š" + newRecord.time);
        pad.clear();
        document.getElementById('comment').value = '';
    }

    function loginAdmin() {
        if(prompt("è«‹è¼¸å…¥å¯†ç¢¼ï¼š") === "0904") {
            document.getElementById('admin-panel').style.display = 'block';
            refreshAdminUI();
        }
    }

    function refreshAdminUI() {
        // 1. çµ±è¨ˆèª°æ²’ç°½å
        const signedIds = db_records.map(r => parseInt(r.sid));
        const unsigned = students.filter(s => !signedIds.includes(s.id));
        
        const statsArea = document.getElementById('stats-area');
        statsArea.innerHTML = `
            <div class="stats-box">
                <strong>æœªç°½åå­¸ç”Ÿ (${unsigned.length} äºº)ï¼š</strong><br>
                ${unsigned.length > 0 ? unsigned.map(s => s.name).join('ã€') : 'å…¨ç­å·²å®Œæˆç°½åï¼'}
            </div>
            <p style="text-align:center; font-size:0.9em;">å·²ç°½åï¼š${signedIds.length} / 13</p>
        `;

        // 2. é¡¯ç¤ºç•™è¨€èˆ‡ç°½åå…§å®¹
        const recordsArea = document.getElementById('records-area');
        recordsArea.innerHTML = '';
        
        // å°‡ç´€éŒ„æŒ‰æ™‚é–“å€’åºæ’åˆ— (æœ€æ–°çš„åœ¨ä¸Šé¢)
        [...db_records].reverse().forEach(r => {
            recordsArea.innerHTML += `
                <div class="record-card">
                    <div class="record-header">
                        <strong>åº§è™Ÿ ${r.sid} ${r.name}</strong>
                        <span style="color:#999; font-size:0.8em;">${r.time}</span>
                    </div>
                    <div class="comment-text">${r.comment ? r.comment : '<span style="color:#ccc;">(ç„¡ç•™è¨€)</span>'}</div>
                    <img src="${r.sig}" class="sig-img">
                    <button class="delete-btn" onclick="deleteRec(${r.id})">åˆªé™¤æ­¤ç­†è¨˜éŒ„</button>
                </div>
            `;
        });
    }

    function deleteRec(id) {
        if(confirm("ç¢ºå®šåˆªé™¤é€™ç­†ç°½åå—ï¼Ÿ")) {
            db_records = db_records.filter(r => r.id !== id);
            refreshAdminUI();
        }
    }

    function updateHW() {
        const val = document.getElementById('hw-input').value;
        if(val) {
            document.getElementById('hw-content').innerText = val;
            alert("åŠŸèª²å·²æ›´æ–°");
        }
    }

    function viewHistory() {
        alert("æ­£åœ¨è®€å– Firebase æ­·å²åŠŸèª²ç´€éŒ„...");
    }
</script>

</body>
</html>
